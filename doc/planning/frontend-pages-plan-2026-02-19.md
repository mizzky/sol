# フロントエンド ページ構成整理 — チケット詳細（作成日: 2026-02-19）

## 目的
- トップページと管理機能を適切に分離し、一般ユーザーと管理者の動線を明確化する
- ECサイトとして自然なページ構成とナビゲーションを実現する

## 背景・課題
現在のトップページ（`/`）に以下の問題がある：
1. 一般ユーザー向けの「商品一覧」と管理者向けの「商品登録フォーム」が同居している
2. ECサイトとしてのトップページの役割が不明確
3. ナビゲーションが存在せず、ログイン状態やページ遷移が分かりにくい

## あるべきページ構成
```
/                          → 商品一覧（誰でも閲覧可）
/login                     → ログイン ✅ 実装済み
/register                  → ユーザー登録 ❌ 未実装
/admin/products            → 商品管理（追加/編集/削除）管理者のみ
/admin/categories          → カテゴリ管理 管理者のみ（将来）
/admin/users               → ユーザー管理 管理者のみ（将来）
```

## 受け入れ基準
- トップページは商品一覧のみ表示し、誰でも閲覧可能
- 管理機能は `/admin/*` 配下に集約され、管理者のみアクセス可能
- ヘッダーナビゲーションでログイン状態とロールが明確に分かる
- 非管理者が `/admin/*` にアクセスしようとすると適切にリダイレクトされる

---

## チケット一覧

### チケット10: ユーザー登録画面の実装 — Effort: Low, Priority: P0

**内容:**
`/register` ページを作成し、新規ユーザー登録フォームを実装する。

**機能要件:**
- 入力項目: 名前、メールアドレス、パスワード、パスワード確認
- `useAuthStore.register()` を呼び出してAPI連携
- 登録成功後はログインページへリダイレクト
- バリデーションエラーを適切に表示
  - メールアドレス形式チェック
  - パスワード最小文字数（8文字以上）
  - パスワード確認の一致チェック
- 既にログイン済みの場合はトップページへリダイレクト

**影響ファイル:**
- `frontend/app/register/page.tsx` (新規作成)
- `frontend/lib/__tests__/register.test.tsx` (新規作成)

**受け入れ条件:**
- 登録成功後にログインページ（`/login`）へ遷移する
- エラーメッセージ（400, 500）が適切に表示される
- 重複メールアドレスのエラーハンドリング
- Jest テストで正常系・異常系をカバー

**設計メモ:**
```tsx
// UI構成案
- タイトル: 「新規ユーザー登録」
- フォーム:
  - 名前入力
  - メールアドレス入力
  - パスワード入力（type="password"）
  - パスワード確認入力
  - 登録ボタン
- 既にアカウントをお持ちの方: ログインへのリンク
- エラー表示エリア
```

---

### チケット11: トップページと管理ページの分離 — Effort: Med, Priority: P0

**内容:**
現在のトップページから管理機能を分離し、適切なページ構成を実現する。

**変更内容:**

#### 11-1: トップページのリファクタリング
- **ファイル:** `frontend/app/page.tsx`
- **変更:**
  - 商品登録フォームを削除
  - 商品一覧表示のみに特化
  - デザインを改善（カード形式、画像対応準備）
  - ローディング状態の改善

#### 11-2: 管理ページの作成
- **ファイル:** `frontend/app/admin/products/page.tsx` (新規)
- **機能:**
  - 商品追加フォーム（現在のトップページから移行）
  - 商品一覧（編集・削除ボタン付き）
  - 管理者のみアクセス可能（クライアント側チェック）
- **認可:**
  - ログインしていない場合 → `/login` へリダイレクト
  - ログイン済みだが管理者でない場合 → トップページへリダイレクト + エラー表示

#### 11-3: ナビゲーションヘッダーの実装
- **ファイル:** `frontend/app/components/Header.tsx` (新規)
- **表示内容:**
  - サイトロゴ/タイトル（トップページへのリンク）
  - ナビゲーションリンク:
    - 未ログイン: [ログイン] [新規登録]
    - ログイン済み（一般）: [こんにちは、〇〇さん] [ログアウト]
    - ログイン済み（管理者）: [こんにちは、〇〇さん（管理者）] [商品管理] [ログアウト]

#### 11-4: レイアウトの更新
- **ファイル:** `frontend/app/layout.tsx`
- **変更:** Header コンポーネントを全ページに適用

**影響ファイル:**
- `frontend/app/page.tsx` (修正)
- `frontend/app/admin/products/page.tsx` (新規作成)
- `frontend/app/components/Header.tsx` (新規作成)
- `frontend/app/layout.tsx` (修正)
- `frontend/lib/__tests__/admin.products.test.tsx` (新規作成)
- `frontend/lib/__tests__/Header.test.tsx` (新規作成)

**受け入れ条件:**
- 一般ユーザーは商品一覧のみ閲覧可能
- 管理者は `/admin/products` で商品追加・編集が可能
- 非管理者が `/admin/products` にアクセスすると適切にリダイレクト
- ヘッダーでログイン状態とロールが明確に分かる
- すべてのページでナビゲーションが表示される

**設計メモ:**
```
トップページ (/)
┌─────────────────────────────────────┐
│ Header: [Sol Coffee] [ログイン] [登録] │
├─────────────────────────────────────┤
│ 本日のおすすめ                        │
│ ┌─────┐ ┌─────┐ ┌─────┐           │
│ │商品1│ │商品2│ │商品3│ ...       │
│ └─────┘ └─────┘ └─────┘           │
└─────────────────────────────────────┘

管理ページ (/admin/products)
┌─────────────────────────────────────┐
│ Header: [Sol Coffee] [〇〇さん(管理者)] │
│         [商品管理] [ログアウト]        │
├─────────────────────────────────────┤
│ 商品管理                              │
│ ┌─ 新規商品追加 ─────────────────┐  │
│ │ [フォーム]                      │  │
│ └─────────────────────────────────┘  │
│ ┌─ 商品一覧 ─────────────────────┐  │
│ │ 商品1 [編集] [削除]             │  │
│ │ 商品2 [編集] [削除]             │  │
│ └─────────────────────────────────┘  │
└─────────────────────────────────────┘
```

---

### チケット12: 管理者権限チェックミドルウェア（フロント） — Effort: Low, Priority: P1

**内容:**
クライアント側で管理者権限をチェックする共通コンポーネント/HOCを作成する。

**機能要件:**
- `/admin/*` 配下のページを自動的に保護
- 未ログイン → `/login` へリダイレクト
- ログイン済みだが非管理者 → `/` へリダイレクト + エラーメッセージ
- ローディング中の表示

**影響ファイル:**
- `frontend/app/components/AdminRoute.tsx` (新規作成)
- `frontend/app/admin/products/page.tsx` (AdminRouteでラップ)

**受け入れ条件:**
- 管理者でない場合は適切にリダイレクトされる
- ローディング状態が適切に表示される
- テストでリダイレクトロジックを検証

**実装案:**
```tsx
// AdminRoute.tsx
export function AdminRoute({ children }: { children: React.ReactNode }) {
  const { user, token } = useAuthStore();
  const router = useRouter();

  useEffect(() => {
    if (!token) {
      router.push('/login');
    } else if (user && user.role !== 'admin') {
      router.push('/');
      // エラー表示
    }
  }, [token, user, router]);

  if (!token || !user || user.role !== 'admin') {
    return <div>Loading...</div>;
  }

  return <>{children}</>;
}
```

---

## 実装順序の推奨

### フェーズ1: ユーザー登録とナビゲーション（P0）
1. チケット10: ユーザー登録画面の実装
2. チケット11-3: ヘッダーコンポーネントの実装
3. チケット11-4: レイアウトへのヘッダー適用

### フェーズ2: ページ分離（P0）
4. チケット11-2: 管理ページの作成
5. チケット11-1: トップページのリファクタリング

### フェーズ3: 権限チェック強化（P1）
6. チケット12: 管理者権限チェックミドルウェア

---

## テスト戦略

### 単体テスト
- 各ページコンポーネントのレンダリングテスト
- フォーム送信のテスト
- エラーハンドリングのテスト

### 統合テスト（将来）
- ログイン → 商品閲覧 → ログアウトのフロー
- 管理者ログイン → 商品追加 → 商品一覧反映のフロー
- 非管理者による `/admin/*` アクセス拒否のフロー

---

## 関連ドキュメント
- [ユーザー管理計画](./user-management-plan-2026-02-16.md) - チケット8（フロント統合）
- [doc/task.md](../task.md) - 全体タスク管理
- [doc/api.md](../api.md) - API仕様

---

作成日: 2026-02-19

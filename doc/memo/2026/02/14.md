```markdown
# 2026-02-14 作業サマリー（マージ済）

## 概要
本日は商品管理 CRUD（ハンドラ・テスト・ドキュメント）のTDD作業を行い、単体テストの追加とハンドラ修正、ドキュメント更新を完了しました。全テストが通る状態を確認しています。

## 実施内容（要点）
- テスト追加（先行）
  - `TestCreateProduct_SkuConflict_409`, `TestUpdateProduct_SkuConflict_409`
  - `TestProductAuth_AdminOnly_Routes`（認可統合テスト）
  - `TestCreateProduct_NameTooLong`, `TestUpdateProduct_NameTooLong`（バリデーション）
- ハンドラ修正
  - `backend/handler/product.go` にて `name` の最大長チェック（255文字）と `price > 0` のバリデーションを追加
  - `CreateProduct` / `UpdateProduct` の DB エラーに対し `pq.Error` を `errors.As` で判定し、Postgres 一意制約（23505）の場合は `409 Conflict` を返すように実装
- テスト実行
  - 追加したテストを含め `go test ./...` を実行し、全テストがパス（Exit 0）を確認
- ドキュメント更新
  - [doc/api.md](doc/api.md) を更新：`PATCH` を `PUT`（フル更新）に統一、`name` 上限255、`price > 0`、SKU重複時の `409` を明記
  - [doc/task.md](doc/task.md) に作業完了の追記
- 学習ログ作成
  - [doc/memo/2026/02/14_learning.md](doc/memo/2026/02/14_learning.md) を作成（作業の学び・注意点・次アクションを記録）

## 追記: フロントエンド認証・連携作業 (2026-02-14)

- フロント側での準備:
  - `frontend/lib/api.ts` に `API_URL` のエクスポートと API ユーティリティ（`getProducts` / `login` / `createProduct`）を整備。
  - `frontend/store/useAuthStore.ts` を追加し、`token`/`user` の zustand ストア、`localStorage` 永続化、`loadFromStorage` に `/api/me` を試す復元ロジックを組み込んだ。
  - `frontend/app/page.tsx` の fetch ハンドリングを型安全に修正（`unknown` の利用、`useCallback` 化）。

- バックエンド対応・デバッグ:
  - CORS エラー（ブラウザの `Failed to fetch`）を調査。原因は Gin のミドルウェア登録順がルート定義の後になっていて CORS ヘッダが付与されていなかったこと。
  - `backend/main.go` で CORS ミドルウェアをルート設定の前に移動し、開発時の origin（http://localhost:3000, http://localhost:3001）を許可するよう修正。


- 作業の結果:
  - フロントからバックエンドへの API 呼び出しが正常化し、商品一覧取得のエラーが解消された。

今後の注意点:
- `loadFromStorage` はトークンでのサーバ復元(`/api/me`)を優先し、なければ `localStorage` の `auth_user` をフォールバックで利用する方針。
- localStorage にトークンを保存する実装は学習用としては有用だが、本番では HttpOnly Cookie 等を検討する。

記録者: 作業ペア / 作業アシスタント
作成日: 2026-02-14

```
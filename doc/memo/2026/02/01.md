# 開発メモ - 2026/02/01

## 📋 本日の決定事項

### プロジェクト概要
- **再開発対象**: 仮想コーヒーショップシステム
- **技術スタック**: Go (Gin) + Next.js + PostgreSQL
- **開発目的**: キャッチアップ、モダン技術習得
- **メンタリングスタイル**: シニアメンター形式（コード提示 → 自分で写経実装）

---

## 🎯 実装する3つの基本機能

### 1. 会員管理機能
- ✅ 会員登録（既実装）
- 会員情報照会
- 会員情報更新
- 会員削除/退会
- 会員一覧（管理者用）
- **ロール管理**: customer / admin

### 2. 在庫管理機能
- 商品カテゴリ管理（登録・更新・削除）
- ✅ 商品一覧表示（既実装）
- 商品マスタ管理（登録・更新・削除）
- 在庫数管理（入荷・出荷で増減）

### 3. 取引機能
- カート機能（複数商品対応）
- 注文作成（会員のみ購入可能）
- 注文確認・キャンセル
- 取引明細参照
- 売上レポート（管理者用）

---

## 📐 ER図（データベース設計）

```
users (会員テーブル)
├── id (PK)
├── email (UNIQUE)
├── password_hash
├── name
├── role (enum: 'customer', 'admin')
├── created_at
└── updated_at

categories (商品カテゴリテーブル)
├── id (PK)
├── name
├── description
└── created_at

products (商品テーブル)
├── id (PK)
├── category_id (FK → categories)
├── name
├── description
├── price
├── stock_quantity
├── created_at
└── updated_at

carts (カートテーブル)
├── id (PK)
├── user_id (FK → users)
├── product_id (FK → products)
├── quantity
├── created_at
└── updated_at
※ user_id + product_id で UNIQUE制約

orders (注文テーブル)
├── id (PK)
├── user_id (FK → users)
├── total_amount
├── status (enum: 'pending', 'completed', 'cancelled')
├── ordered_at
└── created_at

order_items (注文明細テーブル)
├── id (PK)
├── order_id (FK → orders)
├── product_id (FK → products)
├── quantity
├── unit_price (注文時点の価格を保存)
└── subtotal
```

---

## 🚀 実装ロードマップ

### Phase 1: 商品・カテゴリ管理
1. テーブル作成（migration）
2. sqlc query設定
3. ハンドラー実装（CRUD）

### Phase 2: カート機能
1. テーブル作成
2. API実装（カートに追加・更新・削除）

### Phase 3: 注文・取引
1. テーブル作成
2. 注文作成API（トランザクション含む）
3. 注文確認・キャンセルAPI

---

## 🔐 認可戦略

### ロール別ミドルウェア実装予定
- **管理者のみ**: 商品追加・削除・在庫変更
- **実装方法**: Ginのミドルウェア機能を活用した関数実装
- **例**:
```go
api.POST("/products", auth.AdminOnly(), handler.CreateProductHandler)
```

---

## 📝 技術選定のポイント（確定）

| 領域 | 選択 | 理由 |
|------|------|------|
| バックエンド | Go + Gin | シンプル、高性能 |
| DB | PostgreSQL | スタンダード、安定性 |
| DB操作 | sqlc | 型安全 |
| マイグレーション | golang-migrate | 標準的 |
| フロントエンド | Next.js 16 | モダン、定番 |
| UI | TailwindCSS | 高速開発 |
| 認証補助 | bcrypt + JWT | セキュリティ確保 |

---

## ✅ 次のステップ

1. **Phase 1 スタート**: カテゴリ・商品テーブル作成
2. **ミドルウェア実装**: 管理者権限チェック
3. **CRUD API**: カテゴリ・商品の登録更新削除

